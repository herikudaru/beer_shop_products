language: node_js
esversion: 
  - "6"
node_js: 
  - "8"

install:
  - npm install aws-sdk
  - npm install -g serverless
  - npm install mocha -g

before_script:
  - export AWS_ACCESS_KEY_ID=$TEST_AWS_ACCESS_KEY_ID
  - export AWS_SECRET_ACCESS_KEY=$TEST_AWS_SECRET_ACCESS_KEY

before_deploy:
  - export AWS_ACCESS_KEY_ID=$PROD_AWS_ACCESS_KEY_ID
  - export AWS_SECRET_ACCESS_KEY=$PROD_AWS_SECRET_ACCESS_KEY

jobs:
  include:
    - stage: test deploy
      script: ./sh_commands/test_deploy.sh
    - stage: test the unit
      script: ./sh_commands/test_scripts.sh
    - stage: deploy
      if: branch = master
      script: ./sh_commands/deploy.sh

